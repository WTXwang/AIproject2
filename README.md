# 项目说明

本项目为基于卷积神经网络（ResNet结构）的手写数字识别系统，支持模型训练、图像识别与可视化，适合学习与演示用途。

> 本项目为期末课程作业，功能有限，还请谅解。

## 使用方法（仅含py文件时）

### 1. 安装依赖
- 请确保已安装 Python 3.7 及以上版本。
- 在命令行中运行以下命令安装依赖包：
  ```bash
  pip install -r requirements.txt
  ```

### 2. 训练模型
- 运行以下命令开始训练并生成模型文件（mnist_cnn_model.keras）：
  ```bash
  python train_model.py
  ```

### 3. 手写数字识别
- 识别图片中的手写数字，可通过命令行方式：
  ```bash
  python Digit_detector.py --image 图片路径
  ```
- 若未检测到模型文件，程序会自动调用训练脚本生成模型。
- 也可直接运行：
  ```bash
  python Digit_detector.py
  ```
- 若支持GUI，会弹出可视化界面，选择图片后自动识别。

### 4. 其他说明
- 训练过程和识别结果会在当前目录下生成相关文件（如模型、曲线图、预测样例等）。
- 如需自定义参数，可修改对应py文件中的相关设置。

---

## 文件夹结构说明

```
output_resnet/
  ├─ train_curves.png        # 训练过程损失/准确率曲线
  ├─ predict_samples.png     # 部分预测样例可视化
  ├─ train_history.csv       # 训练过程详细数据
  ├─ train_time              # 训练时间
train_model.py               # 模型训练脚本，生成mnist_cnn_model.keras
Digit_detector.py            # 手写数字识别主程序，支持GUI和命令行识别
requirements.txt             # 依赖包列表
README.txt                   # 项目说明（本文件）
mnist_cnn_model.keras        # 训练好的模型文件
```

---

## 文件功能

### train_model.py
- 用于训练手写数字识别模型。
- 代码逻辑与模型参数详细说明：
  - 加载MNIST数据集（keras.datasets.mnist），将图片归一化到0-1，并扩展为(样本数, 28, 28, 1)。
  - 构建卷积神经网络模型，**采用ResNet残差网络结构**：
    - 多层残差块堆叠，包含卷积、批归一化、ReLU激活及残差连接，有效缓解深层网络的梯度消失问题，提升模型表达能力。
    - 主要参数：
      - 残差块数量：3 个，每个残差块包含 2 层 3x3 卷积（卷积核数分别为 32、64、128），均使用 ReLU 激活和批归一化。
      - 残差连接：每个残差块输入与输出相加。
      - 池化层：每个残差块后接 2x2 最大池化。
      - 全局平均池化：在残差块后进行特征降维。
      - 全连接层：Dense(128, activation='relu')，Dropout(0.15) 防止过拟合。
      - 输出层：Dense(10, activation='softmax')，对应 0-9 十个数字类别。
    - 末端使用全局平均池化和全连接层输出10类（0-9）概率。
    - 具体结构和参数可参考train_model.py源码及文档后续说明。
  - 编译模型：
    - 损失函数：sparse_categorical_crossentropy（适合整数标签的多分类）
    - 优化器：Adam（自适应学习率，默认参数）
    - 评估指标：accuracy
  - 训练模型：
    - 训练轮数（epochs）：20
    - 批大小（batch_size）：64
    - 验证集：MNIST官方测试集
    - 训练过程中自动保存 loss/accuracy 曲线和部分预测样例。
  - 保存模型：
    - 训练完成后，使用 model.save(MODEL_PATH) 保存为 mnist_cnn_model.keras。
  - 训练过程可视化与记录：
    - 使用 pandas 保存训练过程 loss/accuracy 到 train_history.csv。
    - 使用 matplotlib 保存训练曲线（train_curves.png）和部分预测样例（predict_samples.png）。
  - 适合需要重新训练模型或分析训练过程时使用。

### Digit_detector.py
- 手写数字识别主程序。
- 主要流程：
  1. 启动时自动检测当前目录下是否存在mnist_cnn_model.keras。
     - 若无，则自动调用train_model.py训练模型。
     - 若有，则直接加载模型。
  2. 支持两种使用方式：
     - 命令行：传入图片路径，输出识别结果。
     - GUI：可视化界面，选择图片后自动识别并显示结果（预测数字+正确概率）。
  3. 图像预处理与分割说明：
     - 预处理流程：
       1. 灰度化：将图片统一转为灰度图像。
       2. Otsu二值化：自适应阈值分割前景与背景。
       3. 反色处理：确保数字为白色、背景为黑色，与MNIST一致。
       4. 居中：通过质心平移将数字居中。
       5. 缩放与填充：将数字区域缩放为20x20，再填充到28x28，保证与MNIST输入一致。
       6. 归一化：像素值缩放到0-1区间。
     - 分割流程：
       1. 对二值化图像进行轮廓检测，提取所有独立数字区域。
       2. 对每个数字区域进行紧凑裁剪、缩放、居中处理，生成单个数字的28x28图像。
       3. 默认只识别最左侧的数字（可扩展为多数字识别）。
     - 该流程可显著提升对不同来源、不同背景图片的鲁棒性。
  4. 支持多数字分割，默认只识别概率最高的数字。

### requirements.txt
- 项目所需的全部依赖包列表。

### dist/readme.txt
- 可执行文件和模型的详细使用说明。

---

## 注意事项
- 本项目为学习与演示用途，功能和准确率有限。
- 推荐优先运行Digit_detector.py，程序会自动处理模型训练和加载。
- 若需自定义模型训练参数或分析训练过程，可单独运行train_model.py。
- 在简单背景下的单个手写数字识别场景下，程序准确率较高，适合基础演示和教学。

---

如有问题请联系开发者。
